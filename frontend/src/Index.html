<!DOCTYPE html>
<meta charset="utf-8">
<style>
    .background {
        fill: none;
        pointer-events: all;
    }
    
    .map {
        fill: #009688;
        stroke: #f5f5f5;
    }
    
    .border_map {
        fill: none;
        stroke: #333333;
    }
    
    .states-names {
        fill: none;
        stroke: #333333;
    }
    
    .active {
        fill: orange;
    }
    
    .torino_map {
        fill: #fff; 
        stroke: blue; 
        stroke-width: 3px;
    }
    
    .place-label {
        fill: black;
        fill-opacity: 1;
        font-size: 10px;
        font-weight: 300;
        text-anchor: left;
    }
    
    
</style>
<html>

<body>
    
                    <!--MapBox Links-->
<!--
    <link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.css' rel='stylesheet' />
    <script src="https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.js"></script>
-->
    
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    
    
    <script>
        var width = 500,
            height = 500,
            centered;

        var projection = d3.geo.albers()
            .center([0, 41])
            .rotate([347, 0])
            .parallels([35, 45])
            .scale(2000)
            .translate([width / 2, height / 2]);

        var path = d3.geo.path()
            .projection(projection);

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        svg.append("rect")
            .attr("class", "background")
            .attr("width", width)
            .attr("height", height)
            .on("click", clicked);

        var g = svg.append("g");


        d3.json("itx.json", function (error, it) {


            var subunits = topojson.feature(it, it.objects.sub);
          // console.log(topojson.feature(it, it.objects.sub).features);
          // console.log(subunits);
            
            g.append("g")
                .selectAll("path")
                .data(topojson.feature(it, it.objects.sub).features)
                .datum(subunits)
                .enter().append("path")
                .attr("class", "map")
                .attr("d", path)
                .on("click", clicked);


            // draw border with sea
            g.append("path")
                .datum(topojson.mesh(it, it.objects.sub, function (a, b) {
                    return a === b;
                }))
                .attr("class", "border_map")
                .attr("d", path);

           // console.log(topojson.mesh(it, it.objects.sub));
           // console.log(topojson.mesh(it, it.objects.sub).geometries);
            
            
            
            
//            g.selectAll(".place-label")
//                .data(topojson.feature(it, it.objects.sub.geometries))
//                .enter().append("text")
//                .attr("class", "place-label")
//                .attr("transform", function(d) { return "translate(" + projection(d.coordinates) + ")"; })
//                .attr("dx", "0.75em")
//                .text("ciao");
            
            
          //  g.append("path")
          //  .datum(topojson.mesh(it, it.objects.sub))
          //  .attr("fill", function(path) {console.log(path); return "#FF00FF";})
          //  .attr("d", path)
          //  .text("pippo")
          //  .on("click", clicked);

           // function getRandomColor() {
//
           //     return "#FF00FF";
           // }
            
            
            
            
            
            
 //         
 //         g.append("path")
 //             .datum(topojson.mesh(it, it.objects.sub, function(a, b) { return a.id === 'TORINO'; }))
 //             .attr("class", "torino_map")
 //             .attr("d", path);


            g.append("g")
                .attr("class", "states-names")
                .selectAll("text")
                .data(topojson.feature(it, it.objects.sub.geometries))
                .enter()
                .append("g:text")
                .text(function (d) {
                    return d.properties.nome_pro[d.id];
                })






        });


        function clicked(d) {
            var x, y, k;

            if (d && centered !== d) {
                var centroid = path.centroid(d);
                x = centroid[0];
                y = centroid[1];
                k = 4;
                centered = d;
            } else {
                x = width / 2;
                y = height / 2;
                k = 1;
                centered = null;
            }

            g.selectAll("path")
                .classed("active", centered && function (d) {
                    return d === centered;
                });

            g.transition()
                .duration(750)
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
                .style("stroke-width", 1.5 / k + "px");
        }
    </script>
</body>

</html>